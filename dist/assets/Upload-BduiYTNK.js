import{_ as A,o as F,t as R,c as p,a as e,l as S,w as U,v as x,h as B,F as D,r as E,k as L,e as o,f as P,m as $,j,g as _,n as z}from"./index-COHSjGpk.js";const M={class:"page-wrap upload-page"},N={class:"nav"},V={class:"preview-card"},q=["src"],G={class:"play-btn"},H={class:"preview-title"},J={class:"bottom-sheet"},K={class:"photo-list"},O=["onClick"],Q=["src"],T=["disabled"],W={__name:"Upload",setup(X){const k=L(),h=P(),m=k.params.id,u=o(null),c=o(null),r=o(!1),f=o(null),l=o([]),a=o(-1),d=j(()=>a.value>=0&&l.value[a.value]?l.value[a.value]:null);F(()=>{R.detail(m).then(t=>{u.value=t}).catch(()=>{u.value={}})});function b(){c.value&&(r.value?c.value.pause():c.value.play(),r.value=!r.value)}function y(){var t;(t=f.value)==null||t.click()}function C(t){var i;const s=(i=t.target.files)==null?void 0:i[0];if(!s)return;const n=new FileReader;n.onload=()=>{l.value.push(n.result),a.value=l.value.length-1},n.readAsDataURL(s),t.target.value=""}function w(){l.value=[],a.value=-1}function I(){if(d.value){try{sessionStorage.setItem("making_avatar",d.value)}catch{}$.submit({templateId:m,image:d.value}).then(t=>{h.push("/making?taskId="+t.taskId)}).catch(t=>{alert((t==null?void 0:t.message)||"æäº¤å¤±è´¥")})}}return(t,s)=>{var n,i;return _(),p("div",M,[e("header",N,[e("button",{class:"back",onClick:s[0]||(s[0]=g=>S(h).back())},"â€¹"),s[1]||(s[1]=e("span",{class:"tag"},"è¯¥å†…å®¹æ¥è‡ªAIç”Ÿæˆ,è¯·æ³¨æ„ç”„åˆ«",-1))]),e("div",V,[e("div",{class:"video-wrap",onClick:b},[e("video",{ref_key:"videoEl",ref:c,src:(n=u.value)==null?void 0:n.videoUrl,poster:"https://picsum.photos/400/300?random=run",class:"video",loop:"",playsinline:""},null,8,q),U(e("div",G,"â–¶",512),[[x,!r.value]])]),e("p",H,B(((i=u.value)==null?void 0:i.title)||"çš–ç¾Žè¿åŠ¨Â·è·‘æ­¥ç¯‡"),1)]),e("div",J,[e("div",{class:"sheet-head"},[s[2]||(s[2]=e("span",null,"è¯·é€‰æ‹©æ‚¨çš„ç…§ç‰‡",-1)),e("button",{type:"button",class:"del-btn",onClick:w},"åˆ é™¤")]),e("div",K,[e("div",{class:"photo-item add",onClick:y},[...s[3]||(s[3]=[e("span",{class:"camera-icon"},"ðŸ“·",-1),e("span",null,"æ‹æ‘„äººåƒç…§ç‰‡",-1)])]),(_(!0),p(D,null,E(l.value,(g,v)=>(_(),p("div",{key:v,class:z(["photo-item",{selected:a.value===v}]),onClick:Y=>a.value=v},[e("img",{src:g,alt:""},null,8,Q)],10,O))),128))]),e("input",{ref_key:"fileInput",ref:f,type:"file",accept:"image/*",capture:"user",class:"hidden-input",onChange:C},null,544),e("button",{class:"next-btn",disabled:!d.value,onClick:I},"ä¸‹ä¸€æ­¥",8,T)])])}}},ee=A(W,[["__scopeId","data-v-7da858da"]]);export{ee as default};
