# 皖美运动汇 H5 活动 - 接口说明

本文档描述前端调用的所有接口的请求方式、参数与返回格式，便于后端对接或联调。

**约定**

- 基础路径：`/api`（开发环境可配置代理）
- 请求超时：10s
- 除登录、发送验证码外，需在请求头携带登录态（具体字段名由后端约定，如 `Authorization: Bearer <token>`）
- 所有接口均采用下方「统一响应格式」，通过 `code` 判断成功与失败

---

## 统一响应格式

所有接口的响应体均为以下结构：

| 字段    | 类型   | 必填 | 说明 |
|---------|--------|------|------|
| code    | number | 是   | 状态码：`0` 表示成功，非 `0` 表示失败 |
| message | string | 是   | 提示信息，成功时可为 `"success"`，失败时为错误描述 |
| data    | any    | 否   | 业务数据，成功时存在，失败时可为 `null` 或省略 |

**成功示例**

```json
{
  "code": 0,
  "message": "success",
  "data": { ... }
}
```

**失败示例**

```json
{
  "code": 40001,
  "message": "手机号格式错误",
  "data": null
}
```

**状态码约定**

| code | 说明     |
|------|----------|
| 0    | 成功     |
| 40001 | 参数错误（如格式、必填项缺失） |
| 40100 | 未登录或 token 失效 |
| 40101 | 验证码错误或已过期 |
| 40400 | 资源不存在（如模板、作品不存在） |
| 42900 | 请求过于频繁（如验证码 60 秒内重复发送） |
| 5xxxx | 服务端内部错误，具体码由后端定义 |

下文各接口的「响应示例」均按上述统一格式给出完整结构（含 code、message、data）。

---

## 一、认证

### 1.1 登录（验证码）

**接口**：`POST /api/auth/login`

**说明**：使用手机号 + 验证码登录，成功后返回 token，前端需持久化并后续请求携带。

**请求体**（application/json）

| 参数   | 类型   | 必填 | 说明           |
|--------|--------|------|----------------|
| mobile | string | 是   | 11 位手机号    |
| code   | string | 是   | 4～6 位验证码  |

**请求示例**

```json
{
  "mobile": "13800138000",
  "code": "123456"
}
```

**响应示例**

```json
{
  "code": 0,
  "message": "success",
  "data": {
    "token": "eyJhbGciOiJIUzI1NiIs...",
    "mobile": "13800138000"
  }
}
```

**错误说明**

- 手机号格式错误：`code` 40001，`message` 如「手机号格式错误」
- 验证码错误/过期：`code` 40101，`message` 如「验证码错误或已过期」

---

### 1.2 发送验证码

**接口**：`POST /api/auth/sendCode`

**说明**：向指定手机号发送短信验证码，用于登录前获取验证码。建议后端做频率限制（如同一手机 60 秒内仅可请求一次）。

**请求体**（application/json）

| 参数   | 类型   | 必填 | 说明        |
|--------|--------|------|-------------|
| mobile | string | 是   | 11 位手机号 |

**请求示例**

```json
{
  "mobile": "13800138000"
}
```

**响应示例**

```json
{
  "code": 0,
  "message": "success",
  "data": null
}
```

**错误说明**

- 手机号格式错误：`code` 40001，`message` 如「手机号格式错误」
- 发送过于频繁：`code` 42900，`message` 如「请 60 秒后再试」

---

## 二、模板

### 2.1 模板列表

**接口**：`GET /api/template/list`

**说明**：获取热门模板列表，用于首页「热门模板」展示。

**请求参数**：无

**响应示例**

```json
{
  "code": 0,
  "message": "success",
  "data": {
    "list": [
      {
        "id": "1",
        "title": "亲情友情·聚皖里",
        "tag": "乒乓悦动",
        "cover": "https://xxx.com/cover1.jpg",
        "videoUrl": "https://xxx.com/video1.mp4"
      }
    ]
  }
}
```

**列表项字段**（data.list 中每项）

| 字段     | 类型   | 说明           |
|----------|--------|----------------|
| id       | string | 模板 ID        |
| title    | string | 模板标题       |
| tag      | string | 标签（如分类） |
| cover    | string | 封面图 URL     |
| videoUrl | string | 预览/示例视频 URL |

---

### 2.2 模板详情

**接口**：`GET /api/template/:id`

**说明**：根据模板 ID 获取详情，用于「制作同款」详情页展示与上传引导。

**路径参数**

| 参数 | 类型   | 说明    |
|------|--------|---------|
| id   | string | 模板 ID |

**响应示例**

```json
{
  "code": 0,
  "message": "success",
  "data": {
    "id": "1",
    "title": "皖美运动·跑步篇",
    "tag": "乒乓悦动",
    "cover": "https://xxx.com/cover1.jpg",
    "videoUrl": "https://xxx.com/video1.mp4",
    "subtitle": "上传一张您的清晰正面照",
    "desc": "AI将自动为您生成专属运动数字代言"
  }
}
```

**字段说明**（data 中字段）

| 字段     | 类型   | 说明                     |
|----------|--------|--------------------------|
| id       | string | 模板 ID                  |
| title    | string | 模板标题                 |
| tag      | string | 标签                     |
| cover    | string | 封面图 URL               |
| videoUrl | string | 预览视频 URL             |
| subtitle | string | 副标题/上传说明          |
| desc     | string | 功能描述（AI 生成说明等） |

**错误**：模板不存在时 `code` 40400，`message` 如「模板不存在」，`data` 为 null。

---

## 三、作品

### 3.1 作品列表（作品中心）

**接口**：`GET /api/works/list`

**说明**：获取当前用户的「正在生成」任务与「已完成」作品，用于作品中心页。

**请求参数**：无（用户身份由登录态识别）

**响应示例**

```json
{
  "code": 0,
  "message": "success",
  "data": {
    "generating": [
      {
        "taskId": "1",
        "templateId": "1",
        "templateTitle": "皖美运动·跑步篇",
        "avatarUrl": "data:image/png;base64,...",
        "progress": 45,
        "status": "generating"
      }
    ],
    "done": [
      {
        "id": "1000",
        "templateId": "1",
        "templateTitle": "乡土情怀·打球咯",
        "videoUrl": "https://xxx.com/result.mp4",
        "coverUrl": "https://xxx.com/cover.jpg",
        "completedAt": "2026-02-13 14:00",
        "status": "done"
      }
    ],
    "totalCount": 3
  }
}
```

**generating 单项字段**（data.generating 中每项）

| 字段          | 类型   | 说明                    |
|---------------|--------|-------------------------|
| taskId        | string | 制作任务 ID，用于查进度 |
| templateId    | string | 模板 ID                 |
| templateTitle | string | 模板标题                |
| avatarUrl     | string | 用户上传的人脸图 URL/Base64 |
| progress      | number | 0～100 进度百分比       |
| status        | string | 固定为 `"generating"`   |

**done 单项字段**（data.done 中每项）

| 字段          | 类型   | 说明                |
|---------------|--------|---------------------|
| id            | string | 作品 ID             |
| templateId    | string | 模板 ID（分享落地页「制作同款」跳转用） |
| templateTitle | string | 模板标题            |
| videoUrl      | string | 成片视频 URL        |
| coverUrl      | string | 封面图 URL          |
| completedAt   | string | 完成时间，建议格式 `YYYY-MM-DD HH:mm` |
| status        | string | 固定为 `"done"`     |

**totalCount**：number，在 data 中，表示用户累计完成作品数（含本次会话新完成的），用于展示「已累计为家乡代言 N 次」。

---

### 3.2 作品详情

**接口**：`GET /api/works/:id`

**说明**：获取单个作品详情，用于预览页、分享页、分享落地页（需含 templateId 以便「制作同款」跳转）。

**路径参数**

| 参数 | 类型   | 说明   |
|------|--------|--------|
| id   | string | 作品 ID |

**响应示例**

```json
{
  "code": 0,
  "message": "success",
  "data": {
    "id": "1000",
    "templateId": "1",
    "title": "乡土情怀·打球咯",
    "videoUrl": "https://xxx.com/result.mp4",
    "coverUrl": "https://xxx.com/cover.jpg",
    "completedAt": "2026-02-13 14:00"
  }
}
```

**字段说明**（data 中字段）

| 字段         | 类型   | 说明                          |
|--------------|--------|-------------------------------|
| id           | string | 作品 ID                       |
| templateId   | string | 模板 ID（制作同款跳转用）     |
| title        | string | 作品标题（通常同模板标题）    |
| videoUrl     | string | 成片视频 URL                  |
| coverUrl     | string | 封面图 URL                    |
| completedAt  | string | 完成时间，格式 `YYYY-MM-DD HH:mm` |

**错误**：作品不存在时 `code` 40400，`message` 如「作品不存在」，`data` 为 null。

---

### 3.3 提交制作

**接口**：`POST /api/works/submit`

**说明**：选择模板并上传人脸图，提交一次 AI 数字代言制作任务；返回 taskId，前端据此跳转「制作中」页并可在作品中心轮询/刷新进度。

**请求体**（application/json）

| 参数       | 类型   | 必填 | 说明                                      |
|------------|--------|------|-------------------------------------------|
| templateId | string | 是   | 模板 ID                                   |
| image      | string | 是   | 人脸图，Base64 字符串（如 `data:image/jpeg;base64,...`）或可访问的图片 URL |

**请求示例**

```json
{
  "templateId": "1",
  "image": "data:image/jpeg;base64,/9j/4AAQ..."
}
```

**响应示例**

```json
{
  "code": 0,
  "message": "success",
  "data": {
    "taskId": "1"
  }
}
```

**说明**：前端提交后跳转至 `/making?taskId=xxx`，并可在作品中心通过「刷新进度」或轮询 `GET /api/works/progress/:taskId` 获取进度与完成后的 workId。

---

### 3.4 制作进度

**接口**：`GET /api/works/progress/:taskId`

**说明**：查询某次提交任务的制作进度；进度 100% 时返回 workId，前端可跳转作品详情或刷新作品列表。

**路径参数**

| 参数   | 类型   | 说明       |
|--------|--------|------------|
| taskId | string | 提交制作返回的任务 ID |

**响应示例**

**进行中**

```json
{
  "code": 0,
  "message": "success",
  "data": {
    "progress": 60,
    "workId": null
  }
}
```

**已完成**

```json
{
  "code": 0,
  "message": "success",
  "data": {
    "progress": 100,
    "workId": "1000"
  }
}
```

**字段说明**（data 中字段）

| 字段     | 类型   | 说明                          |
|----------|--------|-------------------------------|
| progress | number | 0～100 进度百分比             |
| workId   | string \| null | 完成后为作品 ID，未完成为 null |

---

## 四、接口汇总表

| 模块   | 方法 | 路径                        | 说明           |
|--------|------|-----------------------------|----------------|
| 认证   | POST | /api/auth/sendCode          | 发送验证码     |
| 认证   | POST | /api/auth/login             | 手机号+验证码登录 |
| 模板   | GET  | /api/template/list         | 模板列表       |
| 模板   | GET  | /api/template/:id           | 模板详情       |
| 作品   | GET  | /api/works/list             | 作品中心列表   |
| 作品   | GET  | /api/works/:id              | 作品详情       |
| 作品   | POST | /api/works/submit           | 提交制作       |
| 作品   | GET  | /api/works/progress/:taskId | 制作进度       |

---

## 五、Mock 说明

当前在开发环境（`import.meta.env.DEV`）下，前端直接走本地 Mock，不请求真实服务端：

- 发送验证码：仅校验手机号 11 位即成功，不真实发短信。
- 登录：校验手机号 11 位、验证码 4～6 位即通过，返回 mock token。
- 模板：数据来自 `src/mock/templates.js`，可在此文件增删改模板。
- 作品：数据与进度在 `src/mock/works.js` 内存中维护；提交后约 3 秒内进度从 0 增至 100并写入「已完成」列表。

对接真实后端时，将 `src/api/index.js` 中的 `useMock` 改为 `false`（或通过环境变量控制），并配置好 `baseURL` 与请求头（如 Authorization），即可切到真实接口。
